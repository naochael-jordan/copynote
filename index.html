<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>CopyNote</title>
  </head>
  <body>
    <!-- <div id="app"></div> -->

    <script>
      const { ipcRenderer, remote } = require ('electron');
      const Datastore = require('nedb');
      const Menu = remote.Menu;
      const MenuItem = remote.MenuItem;
      const LABEL_LENGTH_LIMIT = 20;

      const menu = new Menu();
      const db = new Datastore({
        filename: 'db/data.db',
        autoload: true,
      });

      function trancate(text) {
        return text.length <= LABEL_LENGTH_LIMIT ? text : `${text.substring(0, LABEL_LENGTH_LIMIT)}...`;
      }

      // データベースから日付が新しい順で取り出して、コンテキストメニューを作る
      db.find({}).sort({ updatedAt: -1 }).exec((err, docs) => {
        docs.forEach((doc, index) => {
          menu.append(
            new MenuItem({
              label: trancate(doc.text),
              click: function(menu) {
                ipcRenderer.send('dismiss', {
                  text: menu.label,
                  index,
                });
              }
            })
          );
        });

        // コンテキストメニューを開く
        menu.popup(remote.getCurrentWindow());
      });

      // require('./dist/renderer/renderer.js')
    </script>
  </body>
</html>
